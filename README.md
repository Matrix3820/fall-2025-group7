# TD/ASD Classification Model V7-1 & ASD Clustering Analysis

Advanced machine learning system for classifying Typically Developing (TD) vs Autism Spectrum Disorder (ASD) individuals based on free response text analysis using XGBoost and comprehensive NLP features.

ASD Subtype identification using Consensus Clustering

## üöÄ Quick Start

### Installation

1. **Clone the repository:**
```bash
git clone <repository-url>
```

2. **Install dependencies (root):**
Create a virtual env and activate it ot just install dependencies in base python
```bash
pip install -r requirements.txt
```

3. **Download Data (root)**
```bash
./data_download.sh
```

4. **Train the model (root):**
```bash
python -m src.Model_V7-1.train
```

5. **Run predictions(root) :**
```bash
python -m src.Model_V7-1.predict
```
This will also run explainability analysis (on global level only) and generate visualizations and CSV predictions under `Results\V7-1`.
For Local level explainability please use the WebApp. Navigate to the Model Results page, select the model and then navigate to the xAI - Explainability Page. Any local explainability results will get saved under  `Results\V7-1\explainability`.

6. **Run Clustering (root) :**
```bash
python .\src\Clustering\cluster_pipeline.py
```
**NOTE** : This script take 15-20 mins to run and requires the user to supply the **BEST_K** after analyzing the plots generated. Once entered it does the Cluster Validation and TD contamination portion.
User can also change the version and metrics within the code to generate new Results folder (Dynamic change through command line will be added later)

7. **Launch the web application (root):**
```bash
streamlit run demo/app.py
```

## üîß Features

### Model Capabilities
- **Characteristic-based Feature Extraction**: Uses Claude 3.5 Sonnet (via AWS Bedrock) to derive 11 characteristic-driven features - (Part of Legacy Models only, Not V7 and V8 family of models)
- **NLP Text Analysis**: Sentiment, readability, lexical diversity, and structural features
- **XGBoost Classification**: Gradient boosting with tuned regularization
- **Explainable AI**: SHAP-based feature importance and contribution analysis
- **Clustering Analysis**: Following Consensus Clustering Style by Monti et al. 2013 and 

### Web Application Features
- **Model Performance Dashboard**: Accuracy, confusion matrix, AUC-ROC
- **Feature Importance Analysis**: Interactive visualizations of model features
- **Explainability Insights**: Understand model decisions and feature contributions and view Local Decision explainations

## üìä Model Performance

See the latest artifacts in:
- `Results/V7-1/test_results_v7-1.json`
- `Results/V7-1/visualizations/model_performance_v7-1.png`
- `Results/V7-1/visualizations/confusion_matrix_v7-1.png`

These are generated by the current V7-1 training and prediction pipelines and reflect the most up-to-date performance.

## üõ†Ô∏è Technical Details

### Dependencies
- **Core ML**: XGBoost, scikit-learn, SHAP, LIME, consensusclustering
- **Data Processing**: pandas, numpy
- **Visualization**: matplotlib, seaborn, plotly
- **Web App**: streamlit
- **NLP**: textblob, nltk, textstat
- **Cloud**: boto3 (for Claude 3.5 Sonnet via AWS Bedrock), transformers (for Qwen and Llama Models through huggingface) - Legacy models only

### Path Management
All critical paths use `pathlib.Path` for cross-platform compatibility.

## LLM AGENTS (Optional) - For Legacy Models

### ü§ñ Claude Sonnet Agent (Optional)
- Location: `src\Agent`
- Used by the feature extractor to enrich characteristic-based features via AWS Bedrock.
- Configure environment in `ANN-Modeling\Code\Agent\.env` with:
  - `aws_access_key_id`
  - `aws_secret_access_key`
  - `aws_session_token`

 ### ü§ñ LLAMA / Qwen HF Agents (Optional)
- Location: `src\Agent`
- Used by the feature extractor to enrich characteristic-based features via HuggingFace.
- Configure environment in `src\Agent\.env` with:
  - `hf_hub_token`
  - `hf_model`

## üìà Results

Key Modeling outputs saved to `Results/V7-1/` include:
- `xgboost_model_v7-1.pkl`, `scaler_v7-1.pkl`, `feature_names_v7-1.pkl`
- `training_results_v7-1.json`, `test_results_v7-1.json`
- `feature_importance_v7-1.json`, `explainability_analysis_v7-1.json`
- `predictions/test_predictions_v7-1.csv`
- Visuals in `visualizations/`: model performance, confusion matrix, feature importance (overall/by target), TD vs ASD comparison

Key Clustering Outputs saved to `Results/Clustering/V1/` include:
- `best_k_selection.json`, `pca_model.pkl`, `scaler.pkl`
- `cluster_profiles` dir
- `plots` dir
- `significance_tests` dir


## üîç Model Explainability

The model provides comprehensive explainability through:
- **SHAP Analysis**: Feature importance and contribution analysis along with Local Explainability
- **LIME Analysis**: Global and Local Explainability
- **TD vs ASD Patterns**: Differences between typically developing and ASD groups

## üõ°Ô∏è Security and Best Practices

- **Proper Validation**: Cross-validation and holdout test sets
- **Regularization**: XGBoost parameters tuned to prevent overfitting
- **Feature Selection**: Correlation-based and VIF based Filtering
